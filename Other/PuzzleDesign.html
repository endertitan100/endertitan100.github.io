<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Mechanics of Insight: Designing Game Puzzles</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        /* Custom Chart Container Styling as per requirements */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 350px;
            max-height: 400px;
        }

        /* Smooth scrolling for navigation */
        html {
            scroll-behavior: smooth;
        }

        /* Hide scrollbar for clean UI in certain panels */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        
        /* Interactive Element States */
        .interactive-card {
            transition: all 0.3s ease;
        }
        .interactive-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        
        .active-tab {
            border-bottom: 2px solid #ea580c; /* Orange-600 */
            color: #ea580c;
        }
    </style>
    
    <!-- Chosen Palette: Warm Neutrals (Stone/Warm Gray) with Burnt Orange Accents for "Insight" and Teal for "Logic". 
         Background: Stone-50. Text: Stone-800. Accent: Orange-600. Secondary: Teal-600. -->
    
    <!-- Application Structure Plan:
         1. Introduction: Contextualizing the "Aha!" moment.
         2. The Cognitive Loop (Process): An interactive flowchart breaking down the player's mental steps (Observe -> Hypothesize -> Experiment).
         3. The Difficulty Sweet Spot (Data): Interactive Chart.js graph demonstrating the Flow State (Challenge vs. Skill) and where "Good" puzzles sit.
         4. Taxonomy of "Clever" (Analysis): A card-based system exploring techniques (Foreshadowing, Affordance, etc.) that elicit the feeling of intelligence.
         5. Puzzle Profile (Comparison): A Radar chart comparing "Tedious" vs. "Insightful" puzzle metrics.
         6. Synthesis: Summary of key takeaways.
         Rationale: This structure moves from the abstract (mental process) to the concrete (data/metrics) to the practical (techniques), mirroring the design process itself.
    -->

    <!-- Visualization & Content Choices:
         1. Flow State Chart: Scatter/Line Chart (Chart.js) -> Visualizes the narrow channel between boredom and anxiety. Interaction: Slider to move player position.
         2. The Cognitive Loop: CSS Grid/Flexbox Diagram -> Uses CSS shapes/Unicode arrows. Interaction: Clicking steps reveals detailed design advice for that stage.
         3. Puzzle Profile: Radar Chart (Chart.js) -> Compares attributes (Logic, Lateral Thinking, Observation). Interaction: Toggles between puzzle types.
         4. Cleverness Cards: Grid Layout -> Info cards. Interaction: Expand details on click.
         All choices use standard DOM elements and Canvas, strictly avoiding SVG and Mermaid as requested.
    -->

    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
</head>
<body class="bg-stone-50 text-stone-800 font-sans leading-relaxed selection:bg-orange-200">

    <!-- Navigation -->
    <nav class="sticky top-0 z-50 bg-stone-50/90 backdrop-blur-md border-b border-stone-200 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16 items-center">
                <div class="flex items-center">
                    <span class="text-2xl font-bold text-stone-900 tracking-tight">
                        <span class="text-orange-600">‚ú¶</span> Insight Engine
                    </span>
                </div>
                <div class="hidden md:flex space-x-8">
                    <button onclick="scrollToSection('intro')" class="hover:text-orange-600 transition-colors">Overview</button>
                    <button onclick="scrollToSection('cognitive-loop')" class="hover:text-orange-600 transition-colors">The Loop</button>
                    <button onclick="scrollToSection('flow-state')" class="hover:text-orange-600 transition-colors">Flow Data</button>
                    <button onclick="scrollToSection('cleverness')" class="hover:text-orange-600 transition-colors">Crafting Clever</button>
                </div>
                <!-- Mobile Menu Button (Functional representation) -->
                <button class="md:hidden text-2xl" onclick="toggleMobileMenu()">‚ò∞</button>
            </div>
        </div>
        <!-- Mobile Menu -->
        <div id="mobile-menu" class="hidden md:hidden bg-white border-b border-stone-200 p-4 space-y-2 shadow-lg">
            <button onclick="scrollToSection('intro'); toggleMobileMenu()" class="block w-full text-left py-2 hover:bg-stone-100 px-2 rounded">Overview</button>
            <button onclick="scrollToSection('cognitive-loop'); toggleMobileMenu()" class="block w-full text-left py-2 hover:bg-stone-100 px-2 rounded">The Loop</button>
            <button onclick="scrollToSection('flow-state'); toggleMobileMenu()" class="block w-full text-left py-2 hover:bg-stone-100 px-2 rounded">Flow Data</button>
            <button onclick="scrollToSection('cleverness'); toggleMobileMenu()" class="block w-full text-left py-2 hover:bg-stone-100 px-2 rounded">Crafting Clever</button>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10 space-y-20">

        <!-- Section 1: Introduction -->
        <section id="intro" class="text-center max-w-3xl mx-auto space-y-6">
            <h1 class="text-4xl md:text-5xl font-extrabold text-stone-900 tracking-tight">
                Architecting the <span class="text-orange-600">"Aha!"</span> Moment
            </h1>
            <p class="text-lg md:text-xl text-stone-600">
                A good puzzle isn't just an obstacle; it's a conversation between the designer and the player. 
                This interactive report analyzes the psychology behind successful puzzle design, breaking down how to move players 
                from confusion to clarity, ensuring that satisfying "I am a genius" afterglow.
            </p>
            <div class="flex justify-center space-x-4 pt-4">
                <div class="bg-white p-4 rounded-lg shadow-sm border border-stone-200 w-32">
                    <div class="text-2xl font-bold text-teal-600">4</div>
                    <div class="text-xs text-stone-500 uppercase tracking-wide">Key Phases</div>
                </div>
                <div class="bg-white p-4 rounded-lg shadow-sm border border-stone-200 w-32">
                    <div class="text-2xl font-bold text-orange-600">100%</div>
                    <div class="text-xs text-stone-500 uppercase tracking-wide">Agency</div>
                </div>
                <div class="bg-white p-4 rounded-lg shadow-sm border border-stone-200 w-32">
                    <div class="text-2xl font-bold text-indigo-600">‚àû</div>
                    <div class="text-xs text-stone-500 uppercase tracking-wide">Iterations</div>
                </div>
            </div>
        </section>

        <!-- Section 2: The Cognitive Loop (Interactive Diagram) -->
        <section id="cognitive-loop" class="bg-white rounded-2xl shadow-sm border border-stone-200 overflow-hidden">
            <div class="p-8 border-b border-stone-100">
                <h2 class="text-2xl font-bold text-stone-900 mb-2">The Cognitive Loop</h2>
                <p class="text-stone-600">
                    Players solve puzzles through a recursive scientific method. To make players think, you must disrupt one of these stages without breaking the loop entirely. 
                    <span class="font-semibold text-orange-600">Click the stages below</span> to explore design strategies for each phase.
                </p>
            </div>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-0">
                <!-- Left: The Visual Flow -->
                <div class="p-8 bg-stone-50 flex flex-col items-center justify-center space-y-4">
                    
                    <!-- Step 1 -->
                    <button onclick="updateLoopDetails('observe')" class="w-full max-w-md bg-white border-l-4 border-teal-500 p-4 shadow-sm hover:shadow-md transition-all text-left group">
                        <div class="flex justify-between items-center">
                            <span class="font-bold text-stone-800">1. Observation</span>
                            <span class="text-stone-400 group-hover:text-teal-500">‚óâ</span>
                        </div>
                        <div class="text-sm text-stone-500 mt-1">Collecting data and affordances.</div>
                    </button>
                    
                    <!-- Arrow -->
                    <div class="text-stone-300 text-xl">‚Üì</div>

                    <!-- Step 2 -->
                    <button onclick="updateLoopDetails('hypothesis')" class="w-full max-w-md bg-white border-l-4 border-indigo-500 p-4 shadow-sm hover:shadow-md transition-all text-left group">
                        <div class="flex justify-between items-center">
                            <span class="font-bold text-stone-800">2. Hypothesis</span>
                            <span class="text-stone-400 group-hover:text-indigo-500">?</span>
                        </div>
                        <div class="text-sm text-stone-500 mt-1">Formulating a potential solution.</div>
                    </button>

                    <!-- Arrow -->
                    <div class="text-stone-300 text-xl">‚Üì</div>

                    <!-- Step 3 -->
                    <button onclick="updateLoopDetails('experiment')" class="w-full max-w-md bg-white border-l-4 border-orange-500 p-4 shadow-sm hover:shadow-md transition-all text-left group">
                        <div class="flex justify-between items-center">
                            <span class="font-bold text-stone-800">3. Experiment</span>
                            <span class="text-stone-400 group-hover:text-orange-500">‚ö°</span>
                        </div>
                        <div class="text-sm text-stone-500 mt-1">Executing the action.</div>
                    </button>

                    <!-- Arrow -->
                    <div class="text-stone-300 text-xl">‚Üì</div>

                    <!-- Step 4 -->
                    <button onclick="updateLoopDetails('analysis')" class="w-full max-w-md bg-white border-l-4 border-rose-500 p-4 shadow-sm hover:shadow-md transition-all text-left group">
                        <div class="flex justify-between items-center">
                            <span class="font-bold text-stone-800">4. Analysis</span>
                            <span class="text-stone-400 group-hover:text-rose-500">‚Üª</span>
                        </div>
                        <div class="text-sm text-stone-500 mt-1">Success or Iteration?</div>
                    </button>

                </div>

                <!-- Right: The Detail Panel -->
                <div class="p-8 flex flex-col justify-center bg-white" id="loop-detail-panel">
                    <div class="mb-4">
                        <span id="detail-tag" class="px-3 py-1 bg-teal-100 text-teal-800 text-xs font-bold rounded-full uppercase tracking-wide">Phase 1</span>
                    </div>
                    <h3 id="detail-title" class="text-2xl font-bold text-stone-900 mb-4">Observation</h3>
                    <p id="detail-desc" class="text-stone-600 mb-6 leading-relaxed">
                        The player enters the room and scans for interactive objects. The primary failure here is "Pixel Hunting." Good puzzles clearly communicate what <em>can</em> be touched, even if the result isn't known.
                    </p>
                    
                    <div class="bg-stone-50 p-4 rounded-lg border border-stone-200">
                        <h4 class="font-bold text-stone-800 mb-2">Designer's Checklist:</h4>
                        <ul id="detail-list" class="list-disc list-inside text-sm text-stone-600 space-y-2">
                            <li>Use consistent lighting/color coding for interactables (e.g., Mirror's Edge Red).</li>
                            <li>Ensure the goal is visible before the solution is understood.</li>
                            <li>Remove visual noise that looks interactive but isn't.</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 3: The Flow State (Chart.js) -->
        <section id="flow-state">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Text Content -->
                <div class="lg:col-span-1 space-y-4">
                    <h2 class="text-2xl font-bold text-stone-900">Balancing Friction</h2>
                    <p class="text-stone-600">
                        To make a player feel clever, you must maintain <strong>Flow</strong>. 
                        If a puzzle is too hard relative to skill, the player feels anxiety. Too easy, boredom.
                    </p>
                    <p class="text-stone-600">
                        The "Clever" zone exists right at the upper edge of the Flow Channel‚Äîwhere the challenge slightly exceeds current mastery, demanding a cognitive leap.
                    </p>
                    
                    <div class="p-4 bg-orange-50 border border-orange-100 rounded-lg mt-6">
                        <label class="block text-sm font-bold text-orange-800 mb-2">Adjust Player Skill Level:</label>
                        <input type="range" id="skillSlider" min="0" max="10" value="5" class="w-full h-2 bg-orange-200 rounded-lg appearance-none cursor-pointer accent-orange-600">
                        <div class="flex justify-between text-xs text-orange-600 mt-1">
                            <span>Novice</span>
                            <span>Expert</span>
                        </div>
                        <br>
                        <label class="block text-sm font-bold text-orange-800 mb-2">Adjust Puzzle Challenge:</label>
                        <input type="range" id="challengeSlider" min="0" max="10" value="5" class="w-full h-2 bg-orange-200 rounded-lg appearance-none cursor-pointer accent-orange-600">
                        <div class="flex justify-between text-xs text-orange-600 mt-1">
                            <span>Easy</span>
                            <span>Difficult</span>
                        </div>
                    </div>
                    <div id="flow-status" class="text-center font-bold text-lg text-stone-800 mt-2 transition-all">
                        Current State: Flow
                    </div>
                </div>

                <!-- Chart Container -->
                <div class="lg:col-span-2 bg-white p-6 rounded-2xl shadow-sm border border-stone-200">
                    <div class="chart-container">
                        <canvas id="flowChart"></canvas>
                    </div>
                    <p class="text-center text-xs text-stone-400 mt-2">The Flow Channel: Mihaly Csikszentmihalyi's Model adapted for Game Mechanics</p>
                </div>
            </div>
        </section>

        <!-- Section 4: Taxonomy of "Clever" (Cards) -->
        <section id="cleverness" class="space-y-6">
            <div class="max-w-3xl">
                <h2 class="text-2xl font-bold text-stone-900 mb-2">The "Clever" Factor</h2>
                <p class="text-stone-600">
                    How do we ensure the player attributes the success to their own intellect rather than random guessing? 
                    It comes down to <strong>Information Architecture</strong> within the level design.
                </p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Card 1 -->
                <div class="bg-white p-6 rounded-xl border border-stone-200 shadow-sm interactive-card">
                    <div class="w-10 h-10 bg-teal-100 text-teal-600 rounded-full flex items-center justify-center text-xl mb-4">‚öì</div>
                    <h3 class="font-bold text-stone-900 mb-2">Anchoring</h3>
                    <p class="text-sm text-stone-600 mb-4">Establishing a rule early, then asking the player to apply it in a new context.</p>
                    <div class="text-xs bg-stone-100 p-2 rounded text-stone-500">
                        <strong>Why it works:</strong> The player feels smart for <em>remembering</em> and <em>applying</em> knowledge.
                    </div>
                </div>

                <!-- Card 2 -->
                <div class="bg-white p-6 rounded-xl border border-stone-200 shadow-sm interactive-card">
                    <div class="w-10 h-10 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center text-xl mb-4">üî¶</div>
                    <h3 class="font-bold text-stone-900 mb-2">Signposting</h3>
                    <p class="text-sm text-stone-600 mb-4">Subtle environmental cues (lighting, texture) that guide the eye without text.</p>
                    <div class="text-xs bg-stone-100 p-2 rounded text-stone-500">
                        <strong>Why it works:</strong> The player feels they "noticed" something hidden, creating a sense of discovery.
                    </div>
                </div>

                <!-- Card 3 -->
                <div class="bg-white p-6 rounded-xl border border-stone-200 shadow-sm interactive-card">
                    <div class="w-10 h-10 bg-indigo-100 text-indigo-600 rounded-full flex items-center justify-center text-xl mb-4">‚Üª</div>
                    <h3 class="font-bold text-stone-900 mb-2">The "Turn"</h3>
                    <p class="text-sm text-stone-600 mb-4">Presenting an assumption, then forcing the player to invert it (e.g., Portal).</p>
                    <div class="text-xs bg-stone-100 p-2 rounded text-stone-500">
                        <strong>Why it works:</strong> Lateral thinking creates the strongest dopamine rush.
                    </div>
                </div>

                <!-- Card 4 -->
                <div class="bg-white p-6 rounded-xl border border-stone-200 shadow-sm interactive-card">
                    <div class="w-10 h-10 bg-rose-100 text-rose-600 rounded-full flex items-center justify-center text-xl mb-4">‚úÇ</div>
                    <h3 class="font-bold text-stone-900 mb-2">Controlled Red Herrings</h3>
                    <p class="text-sm text-stone-600 mb-4">Distractions that are clearly distinguishable upon closer inspection.</p>
                    <div class="text-xs bg-stone-100 p-2 rounded text-stone-500">
                        <strong>Why it works:</strong> Ruling out options makes the final deduction feel earned.
                    </div>
                </div>

                <!-- Card 5 -->
                <div class="bg-white p-6 rounded-xl border border-stone-200 shadow-sm interactive-card">
                    <div class="w-10 h-10 bg-amber-100 text-amber-600 rounded-full flex items-center justify-center text-xl mb-4">‚ö°</div>
                    <h3 class="font-bold text-stone-900 mb-2">Wait Logic</h3>
                    <p class="text-sm text-stone-600 mb-4">Puzzles that require solving <em>after</em> the game session (narrative mysteries).</p>
                    <div class="text-xs bg-stone-100 p-2 rounded text-stone-500">
                        <strong>Why it works:</strong> The "Shower Epiphany." Extends engagement beyond the screen.
                    </div>
                </div>

                <!-- Card 6 -->
                <div class="bg-white p-6 rounded-xl border border-stone-200 shadow-sm interactive-card">
                    <div class="w-10 h-10 bg-emerald-100 text-emerald-600 rounded-full flex items-center justify-center text-xl mb-4">üëÅ</div>
                    <h3 class="font-bold text-stone-900 mb-2">Perspective Shift</h3>
                    <p class="text-sm text-stone-600 mb-4">Physically moving the character to reveal a solution hidden in plain sight.</p>
                    <div class="text-xs bg-stone-100 p-2 rounded text-stone-500">
                        <strong>Why it works:</strong> Rewards spatial awareness over brute force logic.
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 5: Puzzle Profiling (Radar Chart) -->
        <section class="bg-stone-900 text-white rounded-2xl shadow-lg overflow-hidden">
            <div class="grid grid-cols-1 lg:grid-cols-2">
                <div class="p-8 flex flex-col justify-center">
                    <h2 class="text-2xl font-bold text-white mb-4">The "Good Puzzle" Profile</h2>
                    <p class="text-stone-400 mb-6">
                        Not all difficulty is created equal. A "Bad Hard" puzzle relies on obscurity and trial-and-error. 
                        A "Good Hard" puzzle relies on logic and lateral thinking.
                    </p>
                    
                    <div class="space-y-3">
                        <button onclick="updateRadar('good')" class="w-full text-left px-4 py-3 rounded-lg bg-teal-900/30 hover:bg-teal-900/50 border border-teal-800 transition-colors flex justify-between items-center group">
                            <span>Good Puzzle Profile</span>
                            <span class="text-teal-400 group-hover:translate-x-1 transition-transform">‚Üí</span>
                        </button>
                        <button onclick="updateRadar('bad')" class="w-full text-left px-4 py-3 rounded-lg bg-rose-900/30 hover:bg-rose-900/50 border border-rose-800 transition-colors flex justify-between items-center group">
                            <span>Bad Puzzle Profile</span>
                            <span class="text-rose-400 group-hover:translate-x-1 transition-transform">‚Üí</span>
                        </button>
                    </div>

                    <div class="mt-8 pt-8 border-t border-stone-800 text-sm text-stone-500">
                        <p class="italic">"The player should feel like the solution was inside them the whole time."</p>
                    </div>
                </div>
                
                <div class="p-8 bg-stone-800 flex items-center justify-center">
                    <div class="chart-container">
                        <canvas id="radarChart"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="text-center text-stone-500 text-sm py-10 border-t border-stone-200">
            <p>Generated Interactive Report &bull; Game Design Analysis</p>
        </footer>

    </main>

    <script>
        // --- DATA STORAGE & STATE ---
        
        const loopData = {
            observe: {
                title: "Observation",
                tag: "Phase 1",
                colorClass: "text-teal-800 bg-teal-100",
                desc: "The player enters the room and scans for interactive objects. The primary failure here is 'Pixel Hunting.' Good puzzles clearly communicate what <em>can</em> be touched, even if the result isn't known.",
                list: [
                    "Use consistent lighting/color coding (e.g., Uncharted Yellow, Mirror's Edge Red).",
                    "Ensure the goal is visible before the solution is understood.",
                    "Remove visual noise that looks interactive but isn't."
                ]
            },
            hypothesis: {
                title: "Hypothesis",
                tag: "Phase 2",
                colorClass: "text-indigo-800 bg-indigo-100",
                desc: "The player forms a mental model: 'If I pull this lever, that door might open.' This requires the game to have established rules previously.",
                list: [
                    "Teach mechanics in isolation before combining them.",
                    "Ensure cause-and-effect logic is consistent with the game world.",
                    "Avoid 'Moon Logic' (solutions that require outside knowledge)."
                ]
            },
            experiment: {
                title: "Experiment",
                tag: "Phase 3",
                colorClass: "text-orange-800 bg-orange-100",
                desc: "The player acts. Feedback must be immediate and clear. Even a failed experiment must provide information.",
                list: [
                    "Visual/Audio feedback for every interaction is mandatory.",
                    "Failed attempts should hint at <em>why</em> they failed (e.g., a spark showing a wire is cut).",
                    "Animation timing shouldn't penalize the player's thinking speed."
                ]
            },
            analysis: {
                title: "Analysis",
                tag: "Phase 4",
                colorClass: "text-rose-800 bg-rose-100",
                desc: "Did it work? If yes, dopamine. If no, the player updates their mental model. This loop repeats until the 'Aha!' moment.",
                list: [
                    "Don't reset the entire puzzle on one mistake (save states).",
                    "Allow the player to undo moves easily.",
                    "If the player loops too long, subtle dynamic hints (voice lines) can prevent rage-quitting."
                ]
            }
        };

        const radarDataSets = {
            good: {
                label: 'The Insightful Puzzle',
                data: [90, 80, 20, 85, 30],
                backgroundColor: 'rgba(20, 184, 166, 0.2)', // Teal
                borderColor: 'rgba(20, 184, 166, 1)',
                pointBackgroundColor: 'rgba(20, 184, 166, 1)'
            },
            bad: {
                label: 'The Tedious Puzzle',
                data: [30, 20, 95, 10, 80],
                backgroundColor: 'rgba(244, 63, 94, 0.2)', // Rose
                borderColor: 'rgba(244, 63, 94, 1)',
                pointBackgroundColor: 'rgba(244, 63, 94, 1)'
            }
        };

        // --- INTERACTION LOGIC ---

        // 1. Navigation
        function scrollToSection(id) {
            document.getElementById(id).scrollIntoView({ behavior: 'smooth' });
        }

        function toggleMobileMenu() {
            const menu = document.getElementById('mobile-menu');
            menu.classList.toggle('hidden');
        }

        // 2. Cognitive Loop Content Switcher
        function updateLoopDetails(phase) {
            const data = loopData[phase];
            const panel = document.getElementById('loop-detail-panel');
            
            // Simple fade effect
            panel.style.opacity = '0';
            
            setTimeout(() => {
                document.getElementById('detail-tag').innerText = data.tag;
                document.getElementById('detail-tag').className = `px-3 py-1 text-xs font-bold rounded-full uppercase tracking-wide ${data.colorClass}`;
                document.getElementById('detail-title').innerText = data.title;
                document.getElementById('detail-desc').innerHTML = data.desc;
                
                const listContainer = document.getElementById('detail-list');
                listContainer.innerHTML = '';
                data.list.forEach(item => {
                    const li = document.createElement('li');
                    li.innerText = item;
                    listContainer.appendChild(li);
                });
                
                panel.style.opacity = '1';
            }, 200);
        }

        // 3. Flow State Chart & Logic
        let flowChartInstance;
        
        function initFlowChart() {
            const ctx = document.getElementById('flowChart').getContext('2d');
            
            // Base Flow Channel Data
            const flowChannelLower = [];
            const flowChannelUpper = [];
            for(let i=0; i<=10; i++) {
                flowChannelLower.push({x: i, y: Math.max(0, i-2)});
                flowChannelUpper.push({x: i, y: Math.min(10, i+2)});
            }

            flowChartInstance = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [
                        {
                            label: 'Flow Channel Area',
                            data: flowChannelUpper, // Using fill to create the band
                            showLine: true,
                            backgroundColor: 'rgba(234, 88, 12, 0.1)', // Orange tint
                            borderColor: 'transparent',
                            fill: {
                                target: {value: 0}, // Simple fill for visual context
                                above: 'rgba(234, 88, 12, 0.1)' 
                            },
                            pointRadius: 0
                        },
                        {
                            label: 'Player Position',
                            data: [{x: 5, y: 5}], // Starting position
                            backgroundColor: '#ea580c', // Orange-600
                            borderColor: '#fff',
                            borderWidth: 2,
                            pointRadius: 8,
                            pointHoverRadius: 10
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            type: 'linear',
                            position: 'bottom',
                            title: { display: true, text: 'Player Skill' },
                            min: 0,
                            max: 10
                        },
                        y: {
                            type: 'linear',
                            title: { display: true, text: 'Puzzle Challenge' },
                            min: 0,
                            max: 10
                        }
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    if(context.datasetIndex === 1) {
                                        return `Skill: ${context.parsed.x}, Challenge: ${context.parsed.y}`;
                                    }
                                    return '';
                                }
                            }
                        },
                        annotation: {
                            // Using a plugin approach or drawing directly could work, but sticking to basic datasets for compatibility
                        }
                    }
                }
            });
        }

        // Slider Interaction
        const skillSlider = document.getElementById('skillSlider');
        const challengeSlider = document.getElementById('challengeSlider');
        const statusText = document.getElementById('flow-status');

        function updateFlowState() {
            const skill = parseInt(skillSlider.value);
            const puzzleChallenge = parseInt(challengeSlider.value);
            // Update chart point
            flowChartInstance.data.datasets[1].data[0] = { x: skill, y: puzzleChallenge };
            flowChartInstance.update();

            // Update Text
            if (skill < puzzleChallenge - 2) {
                statusText.innerText = "Current State: Anxiety (Puzzle too hard)";
                statusText.className = "text-center font-bold text-lg text-rose-600 mt-2 transition-all";
            } else if (skill > puzzleChallenge + 2) {
                statusText.innerText = "Current State: Boredom (Puzzle too easy)";
                statusText.className = "text-center font-bold text-lg text-stone-400 mt-2 transition-all";
            } else {
                statusText.innerText = "Current State: Flow (The 'Clever' Zone)";
                statusText.className = "text-center font-bold text-lg text-orange-600 mt-2 transition-all";
            }
        }

        skillSlider.addEventListener('input', updateFlowState);
        challengeSlider.addEventListener('input', updateFlowState);

        // 4. Radar Chart Interaction
        let radarChartInstance;

        function initRadarChart() {
            const ctx = document.getElementById('radarChart').getContext('2d');
            
            radarChartInstance = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['Logic', 'Lateral Thinking', 'Brute Force', 'Discovery', 'Obscurity'],
                    datasets: [radarDataSets.good]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            angleLines: { color: 'rgba(255, 255, 255, 0.1)' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' },
                            pointLabels: {
                                color: '#d6d3d1', // Stone-300
                                font: { size: 12 }
                            },
                            ticks: { display: false, max: 100 }
                        }
                    },
                    plugins: {
                        legend: { 
                            labels: { color: 'white' }
                        }
                    }
                }
            });
        }

        function updateRadar(type) {
            radarChartInstance.data.datasets[0] = radarDataSets[type];
            radarChartInstance.update();
        }

        // --- INITIALIZATION ---
        window.addEventListener('DOMContentLoaded', () => {
            initFlowChart();
            initRadarChart();
            
            // Add slight animation to detail panel on load
            document.getElementById('loop-detail-panel').style.transition = "opacity 0.3s ease-in-out";
        });

    </script>
</body>
</html>